<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Профиль</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class = "container py-5 mt-2">
    <header>
        <div class="d-flex flex-column flex-md-row align-items-center pb-3 mb-4 border-bottom">
            <a href="/" class="d-flex align-items-center link-body-emphasis text-decoration-none">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="black" class="bi bi-bag" viewBox="0 0 16 16">
                    <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1m3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/>
                </svg>
                <span class="fs-4 ms-2" style="color: black" ><ya-tr-span data-index="1-0" data-translated="false" data-source-lang="en" data-target-lang="ru" data-value="Pricing example" data-translation="Пример ценообразования" data-ch="0" data-type="trSpan"><b>la_men</b></ya-tr-span></span>
            </a>
            <nav class="d-inline-flex mt-2 mt-md-0 ms-md-auto">
                <a class="me-3 py-2 link-body-emphasis text-decoration-none" href="/profile" style="color: black"><ya-tr-span data-index="2-0" data-translated="false" data-source-lang="en" data-target-lang="ru" data-value="Profile" data-ch="0" data-type="trSpan">Профиль</ya-tr-span></a>
                <a class="me-3 py-2 link-body-emphasis text-decoration-none" href="#" style="color: black"><ya-tr-span data-index="3-0" data-translated="false" data-source-lang="en" data-target-lang="ru" data-value="Support" data-ch="0" data-type="trSpan">Поддержка</ya-tr-span></a>
                <a class="me-3 py-2 link-body-emphasis text-decoration-none" href="#" style="color: black"><ya-tr-span data-index="4-0" data-translated="false" data-source-lang="en" data-target-lang="ru" data-value="About" data-ch="0" data-type="trSpan">О нас</ya-tr-span></a>
                <a type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalChoice"><ya-tr-span data-index="5-0" data-translated="false" data-source-lang="en" data-target-lang="ru" data-value="Support" data-ch="0" data-type="trSpan">Выйти</ya-tr-span></a>
            </nav>
        </div>
    </header>
</div>

<div class = "container py = 5 mt-2">
    <nav aria-label="панировочные сухари">
        <ol class="breadcrumb p-3 bg-body-tertiary rounded-3">
            <li class="breadcrumb-item">
                <a class="link-body-emphasis" href="/">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                        <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                    </svg>
                    <span class="visually-hidden">Главная</span>
                </a>
            </li>
            <li class="breadcrumb-item">
                <a class="link-body-emphasis fw-semibold text-decoration-none" href="/profile">Профиль</a>
            </li>
        </ol>
    </nav>
</div>
<div class="container py-20">
    <div class="row g-5">
        <form action="/profile" method="post" class="needs-validation">
        <div class="col-md-7 col-lg-8">
            <div class="row g-3">
                <div class="col-sm-6">
                    <label for="firstName" class="form-label"><ya-tr-span data-index="14-0" data-translated="true" data-source-lang="en" data-target-lang="ru" data-value="First name" data-translation="Имя пользователя" data-ch="0" data-type="trSpan">Имя пользователя</ya-tr-span></label>
                    <input type="text" name="firstname" class="form-control" id="firstName" placeholder="" th:value="${user.firstname}" required>
                    <div class="invalid-feedback">
                        Valid first name is required.
                    </div>
                </div>

                <div class="col-sm-6">
                    <label for="lastName" class="form-label"><ya-tr-span data-index="15-0" data-translated="true" data-source-lang="en" data-target-lang="ru" data-value="Last name" data-translation="Фамилия" data-ch="0" data-type="trSpan">Фамилия</ya-tr-span></label>
                    <input type="text" name="lastname" class="form-control" id="lastName" placeholder="" th:value="${user.lastname}" required>
                    <div class="invalid-feedback">
                        Valid last name is required.
                    </div>
                </div>

                <div class="col-12">
                    <label for="phone" class="form-label"><ya-tr-span data-index="18-0" data-translated="true" data-source-lang="en" data-target-lang="ru" data-value="Phone " data-translation="Номер мобильного телефона " data-ch="0" data-type="trSpan">Номер мобильного телефона </ya-tr-span></label>
                    <input type="tel" name="phone" class="form-control" id="phone" placeholder="" th:value="${user.phone}" required>
                    <div class="invalid-feedback">
                        Please enter your phone number.
                    </div>
                </div>

                <div class="col-12">
                    <label for="email" class="form-label">Электронная почта</label>
                    <input type="email" name="email" class="form-control" id="email" placeholder="you@example.com" required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" th:value="${user.email}">
                    <div class="invalid-feedback">
                        Пожалуйста, введите корректный адрес электронной почты для получения обновлений по доставке.
                    </div>
                </div>

                <div class="col-12">
                    <label for="date" class="form-label"><ya-tr-span data-index="18-0" data-translated="true" data-source-lang="en" data-target-lang="ru" data-value="Phone " data-translation="Дата рождения " data-ch="0" data-type="trSpan">Дата рождения </ya-tr-span></label>
                    <input type="date" name="birthday" class="form-control" id="date" placeholder=""  th:value="${birthday}" required>

                </div>

                <div class="col-12">
                    <label for="adress" class="form-label"><ya-tr-span data-index="18-0" data-translated="true" data-source-lang="en" data-target-lang="ru" data-value="Phone " data-translation="Город" data-ch="0" data-type="trSpan">Город </ya-tr-span></label>
                    <input type="text" name="town" class="form-control" id="adress" placeholder="Город" th:value="${town}" required>
                </div>
            </div>
            <button class="w-100 btn btn-primary btn-lg mt-4" type="submit"><ya-tr-span data-index="14-0" data-translated="true" data-source-lang="en" data-target-lang="ru" data-value="Continue to checkout" data-translation="Зарегистрироваться" data-ch="0" data-type="trSpan">Применить изменения</ya-tr-span></button>
            </div>
        </form>
    </div>
    <div th:if="${admin != 1}">
        <h2 class="mt-5">Сумма выкупа:</h2>
        <h2 th:text="${user.ransom} + ' руб.'"></h2>
    </div>
    <div th:if="${admin != 1}">
    <div class="mt-5 mb-5">
        <h3>Ваши заказы:</h3>
    </div>
    <div th:if="${orders.isEmpty()}" class="alert alert-secondary container py = 5 mt-3">
        Здесь будут отображаться ваши заказы
    </div>
    <div th:each="el : ${orders}">
    <ul  class="list-group mb-2">
        <li class="list-group-item d-flex justify-content-between lh-sm">
            <div>
                <h3 th:text="'Чек номер ' + ${el.checkNumber}"></h3>
                <img th:src="@{'data:image/png;base64,'+${el.Products.generateBase64Image()}}" width="180" height="240" class="mb-2"/>
                <h3 th:text="${el.Products.name}" class="my-0"></h3>
                <h5 th:text="${el.Products.description}" class="text-body-secondary"></h5>
                <h4 th:text="${el.status} + ', доставка ожидается ' + ${el.delivery_date}" style="color: DarkOrange;" th:if="${el.status != 'Доставлено'}"></h4>
                <h2 th:text="${el.status} + ' ' + ${el.delivery_date}" style="color: lightgreen;" th:if="${el.status == 'Доставлено'}"></h2>
                <a th:href="'/home/' + ${el.Products.id} + '/about'" class="btn btn-primary mb-2 mt-2">Подробнее</a>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#reviewModal" th:data-product-id="${el.Products.id}">
                    Написать отзыв
                </button>
            </div>
            <div th:if="${el.size != '0'}">
                <h5 th:text="'Размер: ' + ${el.size}" class="text-body-secondary mt-5 me-5" ></h5>
            </div>
            <h5 th:text="${el.Products.price} + ' руб.'" class="text-body-secondary mt-5 me-5"></h5>
        </li>
    </ul>
    </div>
    </div>

    <div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reviewModalLabel">Написать отзыв</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="/profile/feedback" method="post">
                        <div class="mb-3">
                            <label for="reviewContent" class="form-label">Текст отзыва</label>
                            <textarea class="form-control" name="feedback" id="reviewContent" rows="5" placeholder="Введите текст отзыва"></textarea>
                        </div>
                        <form id="reviewForm">
                            <input type="hidden" id="productId" name="productId" value="">
                            <button type="submit" class="btn btn-primary">Отправить отзыв</button>
                        </form>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" tabindex="-1" role="dialog" id="modalChoice" aria-labelledby="filterModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content rounded-3 shadow">
                <div class="modal-body p-4 text-center">
                    <h5 class="mb-0"><ya-tr-span data-index="4-0" data-translated="true" data-source-lang="en" data-target-lang="ru" data-value="Enable this setting?" data-translation="Включить этот параметр?" data-ch="0" data-type="trSpan">Выйти?</ya-tr-span></h5>
                    <p th:if="${!basket}" class="mt-2"> Добавленные в корзину товары будут удалены</p>
                </div>
                <form action="/logout" method="get">
                <div class="modal-footer flex-nowrap p-0">
                    <button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 py-3 m-0 rounded-0" data-bs-dismiss="modal"><ya-tr-span data-index="6-1" data-translated="true" data-source-lang="en" data-target-lang="ru" data-value="No thanks" data-translation="Нет" data-ch="0" data-type="trSpan">Нет</ya-tr-span></button>
                    <button type="submit" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 py-3 m-0 rounded-0 border-end"><strong><ya-tr-span data-index="6-0" data-translated="true" data-source-lang="en" data-target-lang="ru" data-value="Yes, enable" data-translation="Да" data-ch="0" data-type="trSpan">Да</ya-tr-span></strong></button>
                </div>
                </form>
            </div>
        </div>
    </div>


    <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
    <div style="margin-left: 20px;" class="col-md-4 d-flex align-items-center" >
        <span class="mb-3 mb-md-0 text-body-secondary">© 2023 la_men, Inc</span>
    </div>
    </footer>
</div>
<script>
    var reviewModal = document.getElementById('reviewModal');
  var reviewForm = document.getElementById('reviewForm');
  var productIdInput = document.getElementById('productId');

     reviewModal.addEventListener('show.bs.modal', function (event) {
    var button = event.relatedTarget;
    var productId = button.getAttribute('data-product-id');
    productIdInput.value = productId;
  });

  reviewForm.addEventListener('submit', function (event) {
    event.preventDefault();
    var formData = new FormData(reviewForm);
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/profile/feedback', true);
    xhr.onload = function () {
      if (xhr.status === 200) {
        // Обработка успешного ответа
      } else {
        // Обработка ошибки
      }
    };
    xhr.send(formData);
  });
</script>
<script>
    // Валидация формы
    (function() {
        'use strict';
        window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
</script>
</body>
</html>